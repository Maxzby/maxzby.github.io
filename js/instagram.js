var Instagram=function(){function g(t){$(".open-ins").html("图片来自instagram，正在加载中…"),$.ajax({url:t,type:"GET",dataType:"jsonp",success:function(t){if(200==t.meta.code){u=u.concat(t.data);t=t.pagination.next_url;if(t)g(t);else{$(".open-ins").html("图片来自instagram，点此访问");for(var i=u,a={},e=0,n=i.length;e<n;e++){var s=new Date(1e3*i[e].created_time),r=s.getFullYear(),s=s.getMonth()+1,o=d(i[e].images.low_resolution.url),l=d(i[e].images.standard_resolution.url),c=i[e].caption?i[e].caption.text:"",m=r+"-"+s;a[m]?(a[m].srclist.push(o),a[m].bigSrclist.push(l),a[m].text.push(c)):a[m]={year:r,month:s,srclist:[l],bigSrclist:[l],text:[c]}}h(a)}}else alert("access_token timeout!")}})}function n(){var t;$(document).width()<=600?$(".img-box").css({width:"auto",height:"auto"}):(t=$(".img-box-ul").width(),t=Math.max(.26*t,157),$(".img-box").width(t).height(t))}var u=[],h=function(s){for(var t in s){for(var i="",a=0,e=s[t].srclist.length;a<e;a++)i+='<li>\t\t\t\t\t\t\t\t<div class="img-box">\t\t\t\t\t\t\t\t\t<a class="img-bg" rel="example_group" href="'+s[t].bigSrclist[a]+'" title="'+s[t].text[a]+'"></a>\t\t\t\t\t\t\t\t\t<img lazy-src="'+s[t].srclist[a]+'" alt="">\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</li>';$('<section class="archives album"><h1 class="year">'+s[t].year+"<em>"+s[t].month+'月</em></h1>\t\t\t\t<ul class="img-box-ul">'+i+"</ul>\t\t\t\t</section>").appendTo($(".instagram"))}$(".instagram").lazyload(),n(),setTimeout(function(){var t,i=s;for(t in i)for(var a=0,e=i[t].srclist.length;a<e;a++){var n=i[t].bigSrclist[a];(new Image).src=n}},3e3),$("a[rel=example_group]").fancybox()},d=function(t){var i;return 0<=t.indexOf("outbound-distilleryimage")?"http://distilleryimage"+t.match(/outbound-distilleryimage([\s\S]*?)\//)[1]+".ak.instagram.com/"+(i=t.split("/"))[i.length-1]:"http://photos-g.ak.instagram.com/hphotos-ak-xpf1/"+(i=t.split("/"))[i.length-1]};return{init:function(){var t=$(".instagram").attr("data-client-id"),i=$(".instagram").attr("data-user-id");if(!t)return alert("Didn't set your instagram client_id.\nPlease see the info on the console of your brower."),void console.log("Please open 'http://instagram.com/developer/clients/manage/' to get your client-id.");g("https://api.instagram.com/v1/users/"+i+"/media/recent/?client_id="+t+"&count=100"),$(window).resize(function(){n()})}}}();$(function(){Instagram.init()});